{% extends "base.html.j2" %}

{% block title %} {{ title if title else "Project Name" }} {% endblock %}

{% block head %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ title if title else "TEXSIB - 10x Goals-Project" }}</h1>
</div>
<div class="goal-list">
    {% for goal in goals %}
    <div class="goal-item">
        <h2>{{ goal['statement'] }}</h2>
        <p>Abteilung: {{ goal['department'] }}</p>
        <p>Kriterien: {{ goal['criteria'] }}</p>
        <p>Bewertung: {{ goal['rating'] }}</p>
        <p>Letzte Änderung: {{ goal['last_modified'] }}</p>
    </div>
    {% endfor %}
</div>
<div class="graph-container">
    <canvas id="goalChart"></canvas>
</div>
{% endblock %}

{% block javascript %}
{{ super() }}
<script type="text/javascript">
    const goalHistory = {{ goal_history | tojson }};
    const labels = goalHistory.map(entry => entry['modified_date']);
    const ratings = goalHistory.map(entry => entry['rating']);

    const ctx = document.getElementById('goalChart').getContext('2d');
    const goalChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Bewertung über die Zeit',
                data: ratings,
                borderColor: 'rgba(221, 11, 47, 1)',
                backgroundColor: 'rgba(221, 11, 47, 0.2)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10
                }
            }
        }
    });
</script>
{% endblock %}